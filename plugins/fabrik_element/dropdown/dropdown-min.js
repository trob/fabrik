var FbDropdown=new Class({Extends:FbElement,initialize:function(a,b){this.plugin="fabrikdropdown";this.parent(a,b);if(this.options.allowadd===true&&this.options.editable!==false){this.watchAddToggle();this.watchAdd()}},watchAddToggle:function(){var a=this.getContainer();var b=a.getElement("div.addoption");var c=a.getElement(".toggle-addoption");if(this.mySlider){var d=b.clone();var e=a.getElement(".fabrikElement");b.getParent().destroy();e.adopt(d);b=a.getElement("div.addoption");b.setStyle("margin",0)}this.mySlider=new Fx.Slide(b,{duration:500});this.mySlider.hide();c.addEvent("click",function(a){a.stop();this.mySlider.toggle()}.bind(this))},watchAdd:function(){var a;if(this.options.allowadd===true&&this.options.editable!==false){var b=this.element.id;var c=this.getContainer();c.getElement("input[type=button]").addEvent("click",function(b){var d=c.getElement("input[name=addPicklistLabel]");var e=c.getElement("input[name=addPicklistValue]");var f=d.value;if(e){a=e.value}else{a=f}if(a===""||f===""){alert(Joomla.JText._("PLG_ELEMENT_DROPDOWN_ENTER_VALUE_LABEL"))}else{var g=(new Element("option",{selected:"selected",value:a})).set("text",f).inject(document.id(this.element.id));b.stop();if(e){e.value=""}d.value="";this.addNewOption(a,f)}}.bind(this))}},getValue:function(){if(!this.options.editable){return this.options.value}if(typeOf(this.element.get("value"))==="null"){return""}return this.element.get("value")},reset:function(){var a=this.options.defaultVal;this.update(a)},update:function(a){var b=[];if(typeOf(a)==="string"&&JSON.validate(a)){a=JSON.decode(a)}if(typeOf(a)==="null"){a=[]}this.getElement();if(typeOf(this.element)==="null"){return}this.options.element=this.element.id;if(!this.options.editable){this.element.set("html","");var c=$H(this.options.data);a.each(function(a){this.element.innerHTML+=c.get(a)+"<br />"}.bind(this));return}b=this.element.getElements("option");for(var d=0;d<b.length;d++){if(a.indexOf(b[d].value)!==-1){b[d].selected=true}else{b[d].selected=false}}this.watchAdd()},cloned:function(){if(this.options.allowadd===true&&this.options.editable!==false){this.watchAddToggle();this.watchAdd()}}})